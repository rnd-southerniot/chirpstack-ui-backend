name: CI Verify Submodule

on:
  workflow_dispatch:
  push:
    branches: [ main ]

permissions:
  contents: read

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout with submodules (SSH deploy key)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: false
          submodules: recursive
          ssh-key: ${{ secrets.SUBMODULE_DEPLOY_KEY }}

      - name: Verify submodule status + contents
        shell: bash
        run: |
          set -euo pipefail
          echo "== submodule status =="
          git submodule status --recursive

          echo "== list smoke-tests =="
          ls -la smoke-tests

          echo "== list smoke scripts =="
          find smoke-tests -maxdepth 1 -type f -name "*.sh" -print
